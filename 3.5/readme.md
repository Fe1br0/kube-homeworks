# Домашнее задание к занятию Troubleshooting

### Цель задания

Устранить неисправности при деплое приложения.

### Чеклист готовности к домашнему заданию

1. Кластер K8s.

### Задание. При деплое приложение web-consumer не может подключиться к auth-db. Необходимо это исправить

1. Установить приложение по команде:
```shell
kubectl apply -f https://raw.githubusercontent.com/netology-code/kuber-homeworks/main/3.5/files/task.yaml
```
2. Выявить проблему и описать.
3. Исправить проблему, описать, что сделано.
4. Продемонстрировать, что проблема решена.


### Правила приёма работы

1. Домашняя работа оформляется в своём Git-репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Файл README.md должен содержать скриншоты вывода необходимых команд, а также скриншоты результатов.
3. Репозиторий должен содержать тексты манифестов или ссылки на них в файле README.md.

### Решение

```Запустил предложенный в задании task.yaml```


 ```По ошибкам стало понятно, что в кластере нет namespace'ов web и data. Создал эти два namespace'a```



 ```Повторяю попытку запуска task.yaml , в этот раз успешно ```



 ``` Проверяю , что было создано ```



```Видим, что все ресурсы созданы корректно в пространствах имен data и web. Для дальнейшего поиска проблемы оценим логи deployment'ов `auth-db` и `web-consumer` ```



```Из логов видно, что под web-consumer-5f87765478-pzrfd не может выполнить разрешение имени `auth-db`. Для уточнения ситуации попробуем выполнить разрешение имени `auth-db` изнутри пода ```



* Разрешение имени не работает также изнутри пода. Попробуем выполнить разрешение изнутри пода по полному имени


* Видим, что по полному имени разрешение изнутри пода работает. Соотвественно, необходимо выполнить редактирование манифеста для deployment'a `web-consumer`, заменив в нем сокращенное имя `auth-db` на полное имя `auth-db.data.svc.cluster.local` в следующем фрагменте конфигурации в блоке `- command:`

```bash
kubectl -n web edit deployments web-consumer
```
```bash
      labels:
        app: web-consumer
    spec:
      containers:
      - command:
        - sh
        - -c
        - while true; do curl auth-db.data.svc.cluster.local; sleep 5; done

```
* После завершения редактирования манифеста, поды автоматически пересоздались
```bash
kubectl -n web edit deployments web-consumer
deployment.apps/web-consumer edited
```
* Вновь оценим логи  web-consumer



Логи `web-consumer`



* Приложение web-consumer получило доступ к приложению auth-db. Проблема решена.